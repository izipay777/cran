# faucet


### How to setup

1. Установите docker и docker-compose
2. Создайте сеть `docker network create faucet`
3. Создайте файл .env в корневой директории, туда необходимо занести всё, что указано в example.env
- `TRON_API_KEY` необходимо получить на [сайте](https://www.trongrid.io/)

4. Для локальных тестов вы можете использовать локально поднятную базу данных
- Для этого необходимо изменить `DATABASE_URL` в .env
- Либо же вы можете использовать базу данных, которая автоматически поднимается c помощью docker-compose
- Для запуска локально необходимо исполнить следующие команды
```
 make up-build
```

5. Для запуска на сервере
- Необходимо изменить `DATABASE_URL` в .env на адрес действующей базы данных!
- Также установить `DEBUG=False`
- Далее необходимо исполнить следующие команды
```
 make build-prod
 make up-prod
 make migrate
```

6. Далее необходимо внести в базу данных всё необходимое
- Сеть **mainnet** для взаимодействия с мэиннетом или **shasta** для тестирования 
- Адреса, которые будут проверяться(Сначала данные заполняются в модели **Address**, а после привязываются к определённой сети)
- И Админские адреса (Модель **ChainAdminAddress**)

7. Сделать всё перечисленное в 6 пункте можно двумя способами!
- Использовать **django admin panel** или консоль `make shell`
- Или закинуть всё в файл **config.txt** и заупстить скрипт после выполнения пункта 4 или 5(контейнеры должны быть запущены и миграции проведены) следующей командой
```
make initialize-database-mainnet
```
- Или если вы хотите, проверить всё в тестнете, то:
```
make initialize-database-testnet
```
- Разница только в том, к какой сети подвяжутся адреса(по умолчанию тестнет адреса подвязываются к **shasta**)
- Вы также можете дописывать новые данные в **config.txt** и запускать скрипт, если хотите много чего добавить за раз, он это сделает!
- В **config.txt** уже прописан пример данных, пожалуйста соблюдайте его формат!
- После строки **#Chains** идут сети где первый параметр, например, **mainnet** - название сети, второй **:30** - минимальный баланс для пополнения в **TRX**, и третий **:40** - на сколько будет пополнен баланс в **TRX**
- После строки **#Admins** идут админские адреса, где до двоеточия base58 адрес, а после приватный ключ
- После строки **#Address** идут адреса, которые будут отслеживаться для пополнения
- В конце каждого набора днных обязательно указывать **end**, иначе ничего работать не будет!

8. Также хочу отметить момент, что api trongrid предоставляет только 100к запросов в день(или 500к с бесплатным периодом в 6 месяцев), так что если вы заметили, что запросов слишком много(а скорее всего так и будет), то необохдимо увеличить время сна парсера! Это необходимо сделать в `src/crypto/management/commands/monitor_balances.py` на 167 строке

### Остановить и удалить контейнеры
```
make down
```

### Заупстить локальные контейнеры
``` 
make up
```

### Заупстить контейнеры прод версии
``` 
make up-prod
```